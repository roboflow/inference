import numpy as np
import pytest
import torch
from inference_exp.configuration import DEFAULT_DEVICE

EXPECTED_DOG_IMAGE_EMBEDDING = torch.tensor(
    [
        [
            -0.04075119271874428,
            0.030913105234503746,
            -0.034607257694005966,
            -0.0029304202180355787,
            -0.029702426865696907,
            0.010483378544449806,
            -0.0523010678589344,
            0.003060581861063838,
            -0.030713386833667755,
            -0.021380331367254257,
            0.02035103552043438,
            -0.01996632292866707,
            0.062420982867479324,
            0.004617805127054453,
            -0.0012754644267261028,
            0.03163842111825943,
            -0.04065162315964699,
            0.036141570657491684,
            0.030317865312099457,
            0.004113323986530304,
            0.011812122538685799,
            0.0046976543962955475,
            0.009477815590798855,
            -0.03016488440334797,
            0.023457122966647148,
            -0.055236462503671646,
            -0.0035813935101032257,
            0.01950719952583313,
            -0.03418688476085663,
            0.05045652389526367,
            -0.020149650052189827,
            -0.04729839414358139,
            0.005834948271512985,
            0.007650166749954224,
            -0.007657324429601431,
            -0.03214602917432785,
            0.007203550543636084,
            0.03812099248170853,
            0.02489309199154377,
            -0.0033768543507903814,
            -0.006631955504417419,
            0.06545425951480865,
            -0.03905041515827179,
            -0.0013650276232510805,
            -0.0006173345609568059,
            0.007834441028535366,
            -0.033216170966625214,
            0.004907420836389065,
            0.05174355208873749,
            0.019534308463335037,
            -0.01941598951816559,
            0.044056106358766556,
            0.009114713408052921,
            -0.052102167159318924,
            0.011376077309250832,
            -0.02167399972677231,
            0.03323625400662422,
            -0.008983301930129528,
            0.015677137300372124,
            -0.011828107759356499,
            0.01556707639247179,
            -0.021678468212485313,
            0.01912843808531761,
            0.04451211541891098,
            0.013199216686189175,
            -0.0069919610396027565,
            -0.013270607218146324,
            -0.00031716350349597633,
            -0.023146113380789757,
            0.0028675892390310764,
            0.02091631293296814,
            -0.003515634685754776,
            0.06263397634029388,
            0.0698840469121933,
            -0.002738209441304207,
            -0.0006873747915960848,
            0.0490938276052475,
            -0.030674438923597336,
            0.0291439276188612,
            -0.06804254651069641,
            0.01094795111566782,
            -0.27910056710243225,
            0.04076093062758446,
            -0.031282730400562286,
            -0.047859907150268555,
            -0.022806532680988312,
            -0.02624671906232834,
            -0.14791612327098846,
            -0.017713943496346474,
            -0.013421345502138138,
            -0.02628149278461933,
            0.009373756125569344,
            0.04224860668182373,
            -0.004163320641964674,
            -0.025386245921254158,
            -0.024043215438723564,
            -0.005446864292025566,
            -0.034565314650535583,
            -0.031390514224767685,
            0.015833774581551552,
            -0.010054443962872028,
            0.03139225393533707,
            -0.004579971078783274,
            0.026150664314627647,
            0.040050312876701355,
            0.012015166692435741,
            0.0168480034917593,
            0.023180752992630005,
            0.04388570040464401,
            0.004739970900118351,
            -0.025841524824500084,
            0.02585764229297638,
            -0.03997727856040001,
            0.0007315564434975386,
            -0.005868840031325817,
            0.032124437391757965,
            0.025020752102136612,
            0.0018484721658751369,
            0.008598918095231056,
            -0.042089637368917465,
            -0.019209295511245728,
            -0.055351365357637405,
            0.009164933115243912,
            -0.04074911028146744,
            0.044315438717603683,
            -0.02069973759353161,
            0.03380432724952698,
            -0.021932266652584076,
            0.008144956082105637,
            0.02967398427426815,
            0.0008248172234743834,
            -0.008208544924855232,
            0.01118883304297924,
            -0.014477764256298542,
            -0.023622658103704453,
            0.00435800151899457,
            -0.02147475816309452,
            -0.021069547161459923,
            0.013778753578662872,
            0.030358878895640373,
            0.04963042959570885,
            -0.009665879420936108,
            0.021770330145955086,
            -0.01867661625146866,
            -0.01913141831755638,
            0.044142115861177444,
            0.030400792136788368,
            0.024888360872864723,
            -0.007498605642467737,
            -0.03804817795753479,
            0.0019578877836465836,
            0.026731247082352638,
            0.0010139571968466043,
            0.007230689749121666,
            0.009671824984252453,
            0.0619954839348793,
            -0.0124235600233078,
            0.018105050548911095,
            0.01740173064172268,
            -0.009460036642849445,
            0.0059605613350868225,
            0.053890034556388855,
            -0.03182144835591316,
            0.009991911239922047,
            -0.03619331493973732,
            -0.0022935555316507816,
            -0.03151234984397888,
            0.014193147420883179,
            -0.012914947234094143,
            -0.02719423547387123,
            -0.08637624979019165,
            -0.025795741006731987,
            -0.044934146106243134,
            -0.05533912777900696,
            0.002168582286685705,
            0.03155698999762535,
            -0.0043593342415988445,
            0.011996174231171608,
            -0.03084326535463333,
            -0.010789407417178154,
            0.09229864180088043,
            -0.012429200112819672,
            0.032024163752794266,
            -0.031798720359802246,
            0.044136106967926025,
            0.015521260909736156,
            -0.054370734840631485,
            -0.027712324634194374,
            -0.013521832413971424,
            0.026286635547876358,
            0.05896761640906334,
            0.02595912106335163,
            -0.02086794190108776,
            0.00033080735011026263,
            -0.021578656509518623,
            -0.01902049221098423,
            -0.009402364492416382,
            0.0067341928370296955,
            -0.06029459089040756,
            -0.0006202548393048346,
            -0.02110167406499386,
            0.004581061657518148,
            -0.13330550491809845,
            -0.010213728062808514,
            0.05568539351224899,
            -0.004265648312866688,
            0.000740360701456666,
            0.016354434192180634,
            0.009476866573095322,
            -0.04390570521354675,
            -0.01853521727025509,
            0.02002842351794243,
            0.052713192999362946,
            -0.004404272418469191,
            0.03971022367477417,
            -0.03294287994503975,
            -0.01806998997926712,
            0.0010829163948073983,
            -0.043504759669303894,
            0.016740228980779648,
            -0.04086172208189964,
            0.006669646129012108,
            0.0042498293332755566,
            0.030403120443224907,
            -0.0032558757811784744,
            0.009562679566442966,
            -0.0328700989484787,
            0.016026733443140984,
            0.04618207737803459,
            0.008119410835206509,
            -0.0010218832176178694,
            0.036330029368400574,
            0.011718548834323883,
            -0.011083805002272129,
            -0.021874593570828438,
            -0.011752731166779995,
            0.019453145563602448,
            -0.005379125010222197,
            0.005506216548383236,
            0.028685005381703377,
            0.015593759715557098,
            0.020729202777147293,
            0.016482563689351082,
            0.031084192916750908,
            -0.06318622827529907,
            0.04566111043095589,
            0.03541935607790947,
            -0.02325630746781826,
            0.021116293966770172,
            -0.032537564635276794,
            -0.014906875789165497,
            -0.021387213841080666,
            0.022568732500076294,
            0.003315247828140855,
            0.0028208664152771235,
            0.01849352940917015,
            0.006338546052575111,
            0.013420241884887218,
            -0.02222847379744053,
            -0.06429608911275864,
            0.0195307619869709,
            -0.027010031044483185,
            -0.0103085832670331,
            -0.02706274762749672,
            0.0013040738413110375,
            0.022559471428394318,
            -0.02386421151459217,
            -0.025564109906554222,
            0.019707968458533287,
            0.014947599731385708,
            0.013455948792397976,
            0.026712218299508095,
            0.00695831561461091,
            -0.017973991110920906,
            -0.04083025082945824,
            0.021450016647577286,
            0.012983724474906921,
            -0.03205520287156105,
            0.005631319712847471,
            0.00861357431858778,
            0.0200659167021513,
            0.012080026790499687,
            0.0019652768969535828,
            0.041335154324769974,
            -0.0037061956245452166,
            -0.03818657621741295,
            0.015839971601963043,
            0.048651423305273056,
            0.041455309838056564,
            -0.007343974895775318,
            0.028259793296456337,
            -0.04666517674922943,
            0.0032921971287578344,
            -0.015401915647089481,
            -0.05058274418115616,
            0.006499821785837412,
            0.05099892243742943,
            -0.03130919113755226,
            0.021793916821479797,
            -0.046661823987960815,
            -0.010973522439599037,
            -0.04070872813463211,
            0.019185291603207588,
            -0.009815659373998642,
            0.010897870175540447,
            0.19098854064941406,
            0.0788431167602539,
            -0.0038214470259845257,
            0.028022775426506996,
            -0.014088748954236507,
            0.01888507418334484,
            0.002838446758687496,
            0.029381992295384407,
            0.005372767336666584,
            0.009347556158900261,
            0.059955161064863205,
            0.03360781818628311,
            0.02250434271991253,
            -0.054121728986501694,
            -0.03659140318632126,
            -0.026190293952822685,
            -0.022331207990646362,
            0.014627674594521523,
            0.0111840283498168,
            -0.022769112139940262,
            0.0005612586974166334,
            0.008292937651276588,
            0.019941262900829315,
            -0.04034890979528427,
            0.008231745101511478,
            -0.057980313897132874,
            0.018272312358021736,
            0.04168643057346344,
            0.0006044012843631208,
            -0.02951764687895775,
            -0.052831269800662994,
            -0.006710782181471586,
            0.0032595836091786623,
            -0.06539850682020187,
            0.04242752864956856,
            -0.0034230356104671955,
            0.02540764771401882,
            -0.01809135638177395,
            -0.007982510142028332,
            0.07054995745420456,
            -0.007184853311628103,
            0.04307287931442261,
            -0.0008429844165220857,
            -0.028477409854531288,
            0.019055023789405823,
            0.025616589933633804,
            -0.002793141407892108,
            0.07172366231679916,
            -0.007346984464675188,
            -0.032178301364183426,
            0.009495188482105732,
            -0.004496528767049313,
            -0.014370675198733807,
            -0.0046049910597503185,
            -0.050813741981983185,
            -0.020507019013166428,
            -0.02938108518719673,
            -0.05689799413084984,
            -0.0005823388928547502,
            0.03231507167220116,
            0.010377798229455948,
            0.00011223849287489429,
            0.08363328129053116,
            -0.052613984793424606,
            -0.03927018865942955,
            -0.0021957599092274904,
            0.0027185138314962387,
            -0.00534780090674758,
            -0.04426344856619835,
            0.028374895453453064,
            -0.00880731362849474,
            0.04072383791208267,
            -0.01964419148862362,
            -0.0298707727342844,
            0.001116138300858438,
            -0.04084702581167221,
            -0.045670606195926666,
            0.0019556088373064995,
            -0.06199923902750015,
            -0.0033002523705363274,
            0.011208796873688698,
            -0.023401755839586258,
            0.02146662399172783,
            0.014620115980505943,
            -0.021311674267053604,
            0.01862153597176075,
            -0.04810455068945885,
            0.0037664715200662613,
            -0.012456277385354042,
            0.0187247171998024,
            -0.029903335496783257,
            0.0023122262209653854,
            0.011093661189079285,
            0.03382797911763191,
            -0.02600121684372425,
            0.03420808166265488,
            -0.02922317199409008,
            0.013987766578793526,
            -0.025125982239842415,
            -0.011795383878052235,
            -0.006625131703913212,
            -0.02107519470155239,
            0.00035549915628507733,
            -0.0013081502402201295,
            0.012053833343088627,
            0.005515701603144407,
            0.01633220911026001,
            0.017276674509048462,
            0.024871695786714554,
            -0.010472930036485195,
            0.010935736820101738,
            0.022897521033883095,
            0.0020068378653377295,
            -0.01936846598982811,
            0.01701636239886284,
            -0.001091082813218236,
            0.05195733532309532,
            0.024166639894247055,
            -0.04860928654670715,
            0.010480809956789017,
            0.021588150411844254,
            -0.030626067891716957,
            0.002366428030654788,
            -0.017712242901325226,
            0.09496953338384628,
            0.02054712362587452,
            -0.011767433024942875,
            0.006623705383390188,
            0.03484552353620529,
            0.010460037738084793,
            0.04738748073577881,
            0.00901932455599308,
            -0.017317067831754684,
            -0.014360148459672928,
            0.025205116719007492,
            0.0016791245434433222,
            0.007112686987966299,
            -0.015921730548143387,
            -0.020794715732336044,
            0.014610033482313156,
            0.03785252198576927,
            0.03283045068383217,
            -0.005336914211511612,
            0.0042650834657251835,
            0.014010332524776459,
            -0.04479365795850754,
            -0.00621485011652112,
            -0.002725110622122884,
            -0.0020685375202447176,
            -0.021286020055413246,
            0.05025646090507507,
            -0.022646088153123856,
            -0.00615276163443923,
            0.06532265245914459,
            0.03689482808113098,
            0.006869752425700426,
            0.007234152872115374,
            0.00010001751070376486,
            0.009461681358516216,
            0.001092961523681879,
            -0.016167981550097466,
            0.008612783625721931,
            0.004860549699515104,
            0.07741066813468933,
            0.04183186963200569,
            -0.027057114988565445,
            0.0440642274916172,
            -0.008615252561867237,
            0.02844952791929245,
            0.004308161325752735,
            -0.006824791897088289,
            0.027326257899403572,
            -0.03771929442882538,
            0.03960120305418968,
            0.007248176261782646,
            0.02532518282532692,
            0.020730597898364067,
            0.003628063714131713,
            -0.014330338686704636,
            -0.039924297481775284,
            -0.007273697294294834,
            0.02025841735303402,
            -0.007598837837576866,
            -0.009758826345205307,
            -0.00625350046902895,
            -0.013323142193257809,
            0.02645091526210308,
            -0.007850159890949726,
            0.04087687283754349,
            -0.001130975317209959,
            -0.03116004168987274,
            -0.019162680953741074,
            -0.023389818146824837,
            0.03402886539697647,
            0.022898489609360695,
            -0.00589756341651082,
            0.025270819664001465,
            -0.014474413357675076,
            -0.002298246370628476,
            0.02596133016049862,
            0.042985640466213226,
            0.005582381505519152,
            0.036385346204042435,
            -0.006806332617998123,
            -0.011000177823007107,
            0.028497423976659775,
            0.062081336975097656,
            0.01019648090004921,
            -0.028916819021105766,
            0.0015952986432239413,
            0.07857725769281387,
            0.0045677111484110355,
            0.010508457198739052,
            -0.008367292582988739,
            0.04847368597984314,
            0.03805025666952133,
            0.016779934987425804,
            0.0066495793871581554,
            0.00817376933991909,
            -0.012354244478046894,
            0.01746879704296589,
            -0.032818567007780075,
            -0.02178412675857544,
            0.042282212525606155,
            -0.006426721345633268,
            -0.0156208835542202,
            0.0449182353913784,
            -0.024116775020956993,
            -0.04025394469499588,
            0.01082733366638422,
            0.017387788742780685,
            -0.007994554936885834,
            0.02419106289744377,
            0.019737616181373596,
            -0.031060632318258286,
            -0.005813525523990393,
            -0.04840872436761856,
            -0.032476603984832764,
            -0.001114480197429657,
            -0.026128022000193596,
            -0.015221934765577316,
            -0.038269106298685074,
            -0.015871267765760422,
            -0.0094110406935215,
            0.013872643932700157,
            -0.018422581255435944,
            0.013635865412652493,
            -0.03517233580350876,
            -0.024013716727495193,
            -0.0038815466687083244,
            -0.014521453529596329,
            0.06392525136470795,
            -0.020650437101721764,
            0.0024154395796358585,
            0.013729739002883434,
            -0.02842634543776512,
            -0.006524986121803522,
            0.03427900746464729,
            0.013109924271702766,
            -0.02245255559682846,
            -0.014808589592576027,
            -0.04221275448799133,
            0.03231603279709816,
            0.049231186509132385,
            -0.02824503369629383,
            0.008707287721335888,
            6.739349919371307e-05,
            -0.008778166025876999,
            -0.008360924199223518,
            0.0059359935112297535,
            0.005700324662029743,
            0.005248975940048695,
            0.027509136125445366,
            0.0044780937023460865,
            -0.016422638669610023,
            -0.026659857481718063,
            -0.012261174619197845,
            -0.0018753387266770005,
            -0.012085435912013054,
            -0.0013118393253535032,
            0.003948253579437733,
            0.009434834122657776,
            -0.03749236464500427,
            0.019711678847670555,
            -0.030547864735126495,
            -0.07930056750774384,
            0.01372358575463295,
            0.015680359676480293,
            -0.005620252341032028,
            -0.014834744855761528,
            0.0038444979581981897,
            0.0258041825145483,
            -0.0025785930920392275,
            0.02497796155512333,
            0.003972322214394808,
            -0.03406097739934921,
            0.011594751849770546,
            0.040016911923885345,
            -0.03388772904872894,
            -0.042472902685403824,
            0.02033969759941101,
            0.06695457547903061,
            -0.006426712032407522,
            0.006155157461762428,
            -0.028321444988250732,
            -0.017928803339600563,
            0.0038607860915362835,
            -0.004022960085421801,
            0.02942667528986931,
            0.030094651505351067,
            -0.008150468580424786,
            -0.033112701028585434,
            -0.023690175265073776,
            -0.010333335027098656,
            -0.013750608079135418,
            0.007335058879107237,
            -0.019441792741417885,
            0.02177416905760765,
            -0.024145619943737984,
            0.015097985975444317,
            -0.017703205347061157,
            -0.02255164459347725,
            0.03114945814013481,
            0.035602323710918427,
            -0.05057249590754509,
            -0.05545760318636894,
            -0.011787597090005875,
            0.01726370118558407,
            0.009742419235408306,
            0.01373038999736309,
            -0.025330988690257072,
            -0.004312425386160612,
            0.004253314808011055,
            0.059009943157434464,
            -0.005726438481360674,
            0.0077961040660738945,
            -0.05412750691175461,
            -0.00755336182191968,
            -0.006039334461092949,
            0.07259217649698257,
            0.00038473677705042064,
            0.028530433773994446,
            0.0431794635951519,
            -0.0026406848337501287,
            -0.005275715608149767,
            -0.007660676725208759,
            -0.004119816701859236,
            0.020582880824804306,
            -0.05580510199069977,
            0.005757872946560383,
            -0.02019021473824978,
            -0.00017300846229773015,
            -0.013740834780037403,
            -0.034772779792547226,
            0.006543910130858421,
            0.018754154443740845,
            0.01621958799660206,
            0.0022161148954182863,
            -0.003434752346947789,
            0.05865770950913429,
            0.009712401777505875,
            -0.013680822215974331,
            0.009557221084833145,
            -0.048528581857681274,
            -0.00414829608052969,
            -0.013222170993685722,
            0.05852352827787399,
            0.042867813259363174,
            -0.07535094767808914,
            -0.0023911602329462767,
            -0.012528776191174984,
            0.024722425267100334,
            -0.05487571656703949,
            -0.016521308571100235,
            -0.04016757011413574,
            -0.025480356067419052,
            0.0015601160703226924,
            0.03729264810681343,
            -0.004576802719384432,
            0.04940607026219368,
            0.018644828349351883,
            0.013290300033986568,
            0.026731640100479126,
            -0.019692014902830124,
            0.04442405328154564,
            0.0019480427727103233,
            0.004646052606403828,
            0.017461949959397316,
            -0.008620679378509521,
            0.011290713213384151,
            -0.01747354120016098,
            0.02261517196893692,
            -0.006826865952461958,
            0.020692886784672737,
            -0.058251116424798965,
            -0.02366098389029503,
            -0.02147969789803028,
            0.012663720175623894,
            0.011372709646821022,
            -0.0238188449293375,
            -0.02030080556869507,
            -0.022105609998106956,
            0.06314268708229065,
            -0.020469194278120995,
            -0.009174047037959099,
            -0.019558150321245193,
            -0.02425737865269184,
            0.019020380452275276,
            -0.02774689346551895,
            0.008195252157747746,
            0.04479848966002464,
            -0.030974578112363815,
            0.00763193191960454,
            -0.008362858556210995,
            0.04235962778329849,
            0.010339424014091492,
            -0.022045550867915154,
            -0.03596395626664162,
            0.00811630580574274,
            0.06716708093881607,
            0.03058314509689808,
            0.005030489526689053,
            -0.03700850531458855,
            0.03817756846547127,
            0.013483038172125816,
            0.045301225036382675,
            0.015321562997996807,
            0.02859424240887165,
            0.0175771601498127,
            0.02437799796462059,
            -0.01862316019833088,
            -0.0008881720714271069,
            -0.036690276116132736,
            -0.025615667924284935,
            -0.030948763713240623,
            -0.007207310292869806,
            0.00305572128854692,
            0.004561312031000853,
            0.024681327864527702,
            -3.136634768452495e-05,
            0.035851627588272095,
            0.001987217925488949,
            -0.0230672899633646,
            0.0405401736497879,
            0.006476780865341425,
            -0.005783367436379194,
            -0.016926787793636322,
            -0.01510704681277275,
            -0.008641949854791164,
            -0.004746089689433575,
            -0.0293772853910923,
            0.018934469670057297,
            0.018132245168089867,
            0.003252547001466155,
            0.009439857676625252,
            0.009847339242696762,
            -0.020672056823968887,
            0.018155204132199287,
            0.0032658076379448175,
            0.00492716021835804,
            -0.009153012186288834,
            0.007278389763087034,
            -0.011968269944190979,
            0.022988880053162575,
            -0.02123335376381874,
            0.03331620618700981,
            0.04874885827302933,
            0.014270368032157421,
            0.026672756299376488,
            0.004042729735374451,
            0.01491701602935791,
            0.006016147788614035,
            0.02584349922835827,
            0.011994127184152603,
            0.02523100934922695,
            -0.01663338951766491,
            0.04529547691345215,
            0.025802627205848694,
            -0.007072147913277149,
            0.05630134791135788,
            0.011100145988166332,
            -0.038130830973386765,
            0.028803931549191475,
            -0.03639696538448334,
            0.021822242066264153,
            0.0027422530110925436,
            -0.06873612850904465,
            -0.0009394732187502086,
            -0.005687441676855087,
            0.03346370905637741,
            -0.021823227405548096,
            -0.035495854914188385,
            -0.010258459486067295,
            -0.048615384846925735,
            0.08125942945480347,
            0.004133432637900114,
            0.003742996836081147,
            -0.03199661150574684,
            0.007078160066157579,
            0.05297418683767319,
            -0.0064433058723807335,
            0.00208988506346941,
            0.007313717622309923,
            -0.02390766143798828,
            -0.004007112234830856,
            -0.024812918156385422,
            -0.028902418911457062,
            -0.01087294053286314,
            -0.02848058007657528,
            0.014201009646058083,
            -0.033302485942840576,
            -0.005733592435717583,
            0.015244920738041401,
            0.0035517564974725246,
            -0.0013466326054185629,
            0.012552225962281227,
            0.03228806331753731,
            0.02047613076865673,
            0.08801106363534927,
            0.013960115611553192,
            -0.008647342212498188,
            0.01566343568265438,
            0.007675148081034422,
            -0.01737808808684349,
            0.031169770285487175,
            0.013921474106609821,
            0.028738398104906082,
            0.03634893521666527,
            -0.04583416506648064,
            -0.026327574625611305,
            0.03189416974782944,
            -0.0072792815044522285,
            -0.012658899649977684,
            -0.08504463732242584,
            -0.0022531310096383095,
            -0.0026559466496109962,
            -0.013185410760343075,
            0.010342972353100777,
            0.011217042803764343,
            0.01593351922929287,
            0.03125758096575737,
            -0.0446968600153923,
            -0.0486011803150177,
            0.02576865628361702,
            7.28325467207469e-05,
            -0.003552557434886694,
            -0.02376171387732029,
            0.014694035984575748,
            -0.018766196444630623,
            -0.04530254378914833,
            -0.011226366274058819,
            -0.05874422565102577,
            0.012121866457164288,
            0.02510238252580166,
            0.02093597874045372,
            -0.047426313161849976,
            -0.010014018975198269,
            -0.04234315827488899,
            0.04627778381109238,
            0.002133377594873309,
            0.03563001751899719,
            -0.03821089118719101,
            -0.017454229295253754,
            0.03014925681054592,
            0.014573687687516212,
            0.01115676760673523,
            -0.009641151875257492,
            -0.03413526713848114,
            -0.023486722260713577,
            -0.033255115151405334,
            0.02795209363102913,
            0.01740621030330658,
            0.08679915219545364,
            -0.002717610215768218,
            -0.016897670924663544,
            -0.000351197348209098,
            -0.024023570120334625,
            0.013586359098553658,
            0.0408627986907959,
            0.049249760806560516,
            -0.004924543667584658,
            -0.02113618701696396,
            0.028457682579755783,
            0.000870757969096303,
            -0.018886422738432884,
            -0.00691308593377471,
            0.013120998628437519,
            0.027984265238046646,
            0.002538050292059779,
            -0.011504397727549076,
            0.013200431130826473,
            -0.009987262077629566,
            0.014843698590993881,
            0.02682611532509327,
            0.02068784274160862,
            0.00894576869904995,
            -0.0050283013842999935,
            0.059736624360084534,
            -0.044494371861219406,
            0.009020591154694557,
            0.012313688173890114,
            0.005585659295320511,
            0.01919609308242798,
            -0.006220580078661442,
            -0.01711971126496792,
            -0.006901815999299288,
            0.0018664528615772724,
            -0.01916862279176712,
            -0.010393932461738586,
            0.01438822690397501,
            -0.053105421364307404,
            0.00935171078890562,
            -0.03212331235408783,
            0.0005378464120440185,
            0.04604475200176239,
            0.020591674372553825,
            -0.032955560833215714,
            0.003483748761937022,
            0.0096166105940938,
            0.020176824182271957,
            0.005025222897529602,
            -0.02009756490588188,
            -0.02324262075126171,
            0.030022520571947098,
            -0.017360540106892586,
            0.016485698521137238,
            0.009823138825595379,
            0.018908342346549034,
            0.004082733299583197,
            -0.001360973110422492,
            0.017489295452833176,
            -0.022011540830135345,
            -0.012597380205988884,
            0.005194579716771841,
            -0.02835916541516781,
            0.01085833553224802,
            0.015863215550780296,
            0.018406404182314873,
            0.006159759126603603,
            0.008459481410682201,
            -0.05935395509004593,
            0.047067731618881226,
            -0.011878213845193386,
            -0.06318311393260956,
            0.03220803663134575,
            0.017691416665911674,
            0.006026414688676596,
            0.1489187479019165,
            0.021813618019223213,
            0.005356069654226303,
            -0.03973446413874626,
            0.008681880310177803,
            0.00680402759462595,
            0.029115907847881317,
            -0.0032517965883016586,
            0.024782266467809677,
            0.02795993909239769,
            0.025973239913582802,
            -0.005512702278792858,
            0.08069363981485367,
            0.033162374049425125,
            0.009248744696378708,
            -0.008278331719338894,
            0.00012358988169580698,
            0.06440521776676178,
            -0.0061384281143546104,
            -0.09849291294813156,
            -0.00011201650340808555,
            0.011162946000695229,
            -0.015976104885339737,
            0.03020261786878109,
            0.04669458046555519,
            -0.014396277256309986,
            0.03305785730481148,
            0.0021928902715444565,
            -0.002829765435308218,
            -0.0013789153890684247,
            0.04987465590238571,
            0.007981399074196815,
            0.054720085114240646,
            0.030001332983374596,
            0.058974627405405045,
            -0.04128540679812431,
            -0.022373227402567863,
            0.05189896374940872,
            0.012607377022504807,
            -0.0010527869453653693,
            0.012513330206274986,
            0.0043219528160989285,
            -0.008372989483177662,
            -0.02582211047410965,
            0.017009995877742767,
            0.01800091750919819,
            0.00399217801168561,
            0.021345490589737892,
            0.005467656999826431,
            -0.017593875527381897,
            -0.01172446459531784,
            0.03538687154650688,
            0.04550374671816826,
            -0.0445743165910244,
            0.01000618003308773,
            -0.04386083409190178,
            0.011716894805431366,
            0.037248387932777405,
            0.0071795047260820866,
            -0.06583205610513687,
            0.022342296317219734,
            -0.044474467635154724,
            -0.014188088476657867,
            -0.03659661486744881,
            0.029665308073163033,
            0.04848167300224304,
            -0.01263538096100092,
            0.028736338019371033,
            -0.018769271671772003,
            -0.010232063941657543,
            0.027445748448371887,
            0.03301752358675003,
        ]
    ],
    device=DEFAULT_DEVICE,
)


@pytest.mark.slow
@pytest.mark.torch_models
def test_perception_encoder_torch_image_prediction_for_numpy(
    perception_encoder_path: str,
    dog_image_numpy: np.ndarray,
) -> None:
    # given
    from inference_exp.models.perception_encoder.perception_encoder_pytorch import (
        PerceptionEncoderTorch,
    )

    model = PerceptionEncoderTorch.from_pretrained(perception_encoder_path)

    # when
    embeddings = model.embed_images(dog_image_numpy)

    # then
    assert tuple(embeddings.shape) == (1, 1024)
    assert torch.allclose(embeddings, EXPECTED_DOG_IMAGE_EMBEDDING, atol=1e-3)


@pytest.mark.slow
@pytest.mark.torch_models
def test_perception_encoder_torch_image_prediction_for_torch_tensor(
    perception_encoder_path: str,
    dog_image_torch: torch.Tensor,
) -> None:
    # given
    from inference_exp.models.perception_encoder.perception_encoder_pytorch import (
        PerceptionEncoderTorch,
    )

    model = PerceptionEncoderTorch.from_pretrained(perception_encoder_path)

    # when
    embeddings = model.embed_images(dog_image_torch)

    # then
    assert tuple(embeddings.shape) == (1, 1024)
    assert torch.allclose(embeddings, EXPECTED_DOG_IMAGE_EMBEDDING, atol=1e-3)


@pytest.mark.slow
@pytest.mark.torch_models
def test_perception_encoder_torch_image_prediction_for_list_of_numpy_bgr(
    perception_encoder_path: str,
    dog_image_numpy: np.ndarray,
) -> None:
    # given
    from inference_exp.models.perception_encoder.perception_encoder_pytorch import (
        PerceptionEncoderTorch,
    )

    model = PerceptionEncoderTorch.from_pretrained(perception_encoder_path)

    # when
    embeddings = model.embed_images([dog_image_numpy, dog_image_numpy])

    # then
    assert tuple(embeddings.shape) == (2, 1024)
    assert torch.allclose(embeddings[0], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)
    assert torch.allclose(embeddings[1], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)


@pytest.mark.slow
@pytest.mark.torch_models
def test_perception_encoder_torch_image_prediction_for_list_of_numpy_rgb(
    perception_encoder_path: str,
    dog_image_numpy: np.ndarray,
) -> None:
    # given
    from inference_exp.models.perception_encoder.perception_encoder_pytorch import (
        PerceptionEncoderTorch,
    )

    model = PerceptionEncoderTorch.from_pretrained(perception_encoder_path)
    rgb_image = np.ascontiguousarray(dog_image_numpy[:, :, ::-1])

    # when
    embeddings = model.embed_images([rgb_image, rgb_image], input_color_format="rgb")

    # then
    assert tuple(embeddings.shape) == (2, 1024)
    assert torch.allclose(embeddings[0], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)
    assert torch.allclose(embeddings[1], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)


@pytest.mark.slow
@pytest.mark.torch_models
def test_perception_encoder_torch_image_prediction_for_list_of_tensors(
    perception_encoder_path: str,
    dog_image_torch: torch.Tensor,
) -> None:
    # given
    from inference_exp.models.perception_encoder.perception_encoder_pytorch import (
        PerceptionEncoderTorch,
    )

    model = PerceptionEncoderTorch.from_pretrained(perception_encoder_path)

    # when
    embeddings = model.embed_images([dog_image_torch, dog_image_torch])

    # then
    assert tuple(embeddings.shape) == (2, 1024)
    assert torch.allclose(embeddings[0], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)
    assert torch.allclose(embeddings[1], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)


@pytest.mark.slow
@pytest.mark.torch_models
def test_perception_encoder_torch_image_prediction_for_list_of_mixed_types(
    perception_encoder_path: str,
    dog_image_numpy: np.ndarray,
    dog_image_torch: torch.Tensor,
) -> None:
    # given
    from inference_exp.models.perception_encoder.perception_encoder_pytorch import (
        PerceptionEncoderTorch,
    )

    model = PerceptionEncoderTorch.from_pretrained(perception_encoder_path)

    # when
    embeddings = model.embed_images([dog_image_numpy, dog_image_torch])

    # then
    assert tuple(embeddings.shape) == (2, 1024)
    assert torch.allclose(embeddings[0], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)
    assert torch.allclose(embeddings[1], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)


@pytest.mark.slow
@pytest.mark.torch_models
def test_perception_encoder_torch_image_prediction_for_batched_tensor(
    perception_encoder_path: str,
    dog_image_torch: torch.Tensor,
) -> None:
    # given
    from inference_exp.models.perception_encoder.perception_encoder_pytorch import (
        PerceptionEncoderTorch,
    )

    model = PerceptionEncoderTorch.from_pretrained(perception_encoder_path)
    batched_input = torch.stack([dog_image_torch, dog_image_torch], dim=0)

    # when
    embeddings = model.embed_images(batched_input)

    # then
    assert tuple(embeddings.shape) == (2, 1024)
    assert torch.allclose(embeddings[0], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)
    assert torch.allclose(embeddings[1], EXPECTED_DOG_IMAGE_EMBEDDING[0], atol=1e-3)
